/*! amoStorage 0.1.0 | Copyright (c) 2014 Author: amo | License: MIT */(function(){"use strict";angular.module("amo.webStorage",[]).provider("amoStorageManager",function(){var a;return a={appName:"amoStorage",revision:"1.0.0",separator:"/",keyGeneratorFactory:function(a,b,c,d){var e;return e=[a,b,d].join(c),function(a){return[e,a].join(c)}},ruleForDeletingRevisions:function(){return!0},$get:["$rootScope",function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;return e=a.appName,k=a.revision,n=a.separator,h=a.keyGeneratorFactory,m=a.ruleForDeletingRevisions,o="#",p="$",g=function(a){return""+e+"/"+a+"/keys"+p},i=g(k),l=""+e+"/revisions"+p,f=function(a,b){var c,d,e,f,h;for(e=g(b),d=angular.fromJson(a.getItem(e)),f=0,h=d.length;h>f;f++)c=d[f],a.removeItem(c);return a.removeItem(e)},j=function(a){var b,c,d,e,g;for(null==a&&(a=localStorage),d=angular.fromJson(a.getItem(l)||"[]"),b=[k],e=0,g=d.length;g>e;e++)c=d[e],k!==c&&(m(c)?f(a,c):b.push(c));return a.setItem(l,angular.toJson(b))},c=function(a,b,c){var d,f,g,i,j;return i=h(e,k,n,b),g=function(a){return""+i(a)+o},f={EXPIRED_TIME:"e",CREATE_DATETIME:"c",LAST_USAGE_DATETIME:"u"},j=function(b,d){var e;return c[b]?(e=angular.fromJson(a.getItem(b)),d-e.config[f.LAST_USAGE_DATETIME]>1e3*e.config[f.EXPIRED_TIME]?(a.removeItem(b),delete c[b],null):e):null},d={confKey:f,get:function(a,b,c){var d;return null==b&&(b=null),null==c&&(c=(new Date).getTime()),a=g(a),d=j(a,c),d?d.value:b},use:function(b,c,d){var e;return null==c&&(c=null),null==d&&(d=(new Date).getTime()),b=g(b),(e=j(b,d))?(e.config[f.LAST_USAGE_DATETIME]=d,a.setItem(b,angular.toJson(e)),e.value):c},set:function(b,d,e,h){var i,j,k;return null==h&&(h=(new Date).getTime()),b=g(b),i=c[b]?angular.fromJson(a.getItem(b)):{config:{},value:d},e&&(i.config[f.EXPIRED_TIME]=e),null==(j=i.config)[k=f.CREATE_DATETIME]&&(j[k]=h),i.config[f.LAST_USAGE_DATETIME]=h,a.setItem(b,angular.toJson(i)),c[b]=!0,this},del:function(b){var d;return d=this.get(b),b=g(b),a.removeItem(b),delete c[b],d}}},d=function(a){var d,e,f,g,h;j(a),h={},f=angular.fromJson(a.getItem(i)||"{}"),g={};for(d in f)g[d]=!0;return e=null,b.$watch(function(){return e||(e=setTimeout(function(){var b,c,h;e=null,h=g,g={},b=!1;for(d in f)g[d]=!0,b||(b=!h[d]),delete h[d];for(c in h){b=!0;break}return b?a.setItem(i,angular.toJson(g)):void 0},100))}),function(b){return null!=h[b]?h[b]:h[b]=c(a,b,f)}},{getLocalStorage:d(localStorage),getSessionStorage:d(sessionStorage)}}]}})}).call(this);