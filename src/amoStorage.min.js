/*! amoStorage 0.2.1 | Copyright (c) 2014 Author: amo | License: MIT */(function(){"use strict";var a;a={},a.isEmptyObj=function(a){var b;for(b in a)return!1;return!0},angular.module("amo.webStorage",[]).provider("amoStorageManager",function(){var b;return b={appName:"amoStorage",revision:"1.0.0",separator:"/",keyGeneratorFactory:function(a,b,c,d){var e;return e=[a,b,d].join(c),function(a){return[e,a].join(c)}},ruleForDeletingRevisions:function(){return!0},$get:["$rootScope",function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;return f=b.appName,m=b.revision,p=b.separator,j=b.keyGeneratorFactory,o=b.ruleForDeletingRevisions,q="#",r="$",i=function(a){return""+f+"/"+a+"/keys"+r},k=i(m),n=""+f+"/revisions"+r,g=function(a,b){var c,d;d=[];for(c in b)a.removeItem(c),d.push(delete b[c]);return d},h=function(a,b){var c,d,e,f;d=i(b),c=angular.fromJson(a.getItem(d));for(e in c)f=c[e],g(a,f);return a.removeItem(d)},l=function(a){var b,c,d,e,f;for(null==a&&(a=localStorage),d=angular.fromJson(a.getItem(n)||"[]"),b=[m],e=0,f=d.length;f>e;e++)c=d[e],m!==c&&(o(c)?h(a,c):b.push(c));return a.setItem(n,angular.toJson(b))},d=function(a,b,c){var d,e,h,i,k;return i=j(f,m,p,b),h=function(a){return""+i(a)+q},e={EXPIRED_TIME:"e",CREATE_DATETIME:"c",LAST_USAGE_DATETIME:"u"},k=function(b,d){var f;return c[b]?(f=angular.fromJson(a.getItem(b)),f?d-f.config[e.LAST_USAGE_DATETIME]>1e3*f.config[e.EXPIRED_TIME]?(a.removeItem(b),delete c[b],null):f:null):null},d={confKey:e,get:function(a,b,c){var d;return null==b&&(b=null),null==c&&(c=(new Date).getTime()),a=h(a),d=k(a,c),d?d.value:b},use:function(b,c,d){var f;return null==c&&(c=null),null==d&&(d=(new Date).getTime()),b=h(b),(f=k(b,d))?(f.config[e.LAST_USAGE_DATETIME]=d,a.setItem(b,angular.toJson(f)),f.value):c},set:function(b,d,f,g){var i,j,k;return null==g&&(g=(new Date).getTime()),b=h(b),i=c[b]?angular.fromJson(a.getItem(b)):{config:{},value:d},f&&(i.config[e.EXPIRED_TIME]=f),null==(j=i.config)[k=e.CREATE_DATETIME]&&(j[k]=g),i.config[e.LAST_USAGE_DATETIME]=g,a.setItem(b,angular.toJson(i)),c[b]=!0,this},del:function(b){var d;return d=this.get(b),b=h(b),a.removeItem(b),delete c[b],d},delAll:function(){return g(a,c)}}},e=function(b){var e,f,g,h,i,j,m;l(b),m={},i=angular.fromJson(b.getItem(k)||"{}"),j={};for(f in i){g=i[f],j[f]={};for(e in g)j[f][e]=!0}return h=null,c.$watch(function(){return h||(h=setTimeout(function(){var c,d,l,m;h=null,d=j,j={},c=!1;for(f in i){g=i[f],j[f]={};for(e in g)j[f][e]=!0,c||(c=!(null!=(l=d[f])?l[e]:void 0)),null!=(m=d[f])&&delete m[e];c||(c=!a.isEmptyObj(d[f]))}return c?b.setItem(k,angular.toJson(j)):void 0},100))}),function(a){return null!=m[a]?m[a]:m[a]=d(b,a,null!=i[a]?i[a]:i[a]={})}},{getLocalStorage:e(localStorage),getSessionStorage:e(sessionStorage)}}]}})}).call(this);